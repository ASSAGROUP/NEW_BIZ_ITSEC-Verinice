--- RCPTT testcase ---
Format-Version: 1.0
Contexts: _HQDeEI9NEeic2YXgdvyDUQ,_lGnj8Ix1Eei2UKUDmonytQ,_mCQwkI9ZEeic2YXgdvyDUQ
Element-Name: test-license-management-client
Element-Type: testcase
Element-Version: 3.0
External-Reference: 
Id: _8rWy4P1wEeqYO5h9EZ3cUQ
Runtime-Version: 2.5.0.202001211718
Save-Time: 9/28/20 4:05 PM
Tags: ISO, clientOnlyTest
Testcase-Type: ecl

------=_.description-216f885c-d591-38ce-8ea2-e4f8cb4d6ffa
Content-Type: text/plain
Entry-Name: .description

Test the license management on the client by importing encrypted content, add the license and check decryption.
Remove the license.
------=_.description-216f885c-d591-38ce-8ea2-e4f8cb4d6ffa--
------=_.content-0a7243a0-75d3-3d5f-9791-539de0e5b7ac
Content-Type: text/ecl
Entry-Name: .content

global [val licenseDate "2021-01-01"]

proc "license-file" {
concat $basedir [get-java-property "file.separator"] 
                           "wrks" [get-java-property "file.separator"]
                           "verinice-workspace" [get-java-property "file.separator"] 
                           "vnl" [get-java-property "file.separator"] 
                           "MY_LIC.vnl"
}

log "test-license-management"

ism-import-vna  MY_LIC.vna

// the the encrypted content
get-button Objektbrowser | click 
get-view ISM | get-tree | select "importierte Objekte/MyLic [64522f]/Controls [64522f]/Control [64522f]"
screen-shot-window "lic-content-encrypted.png"
get-view Objektbrowser | get-control Browser | get-property text | matches ".*<div id=\"content\"><h1>Control</h1><p><p><b><font color=\"red\">Für diesen Benutzer ist keine Lizenz zugewiesen\.<br/>Bitte kontaktieren Sie Ihren Administrator, wenn Sie diesen Inhalt nutzen möchten\.</font></b></p></p></div>.*"
    | verify-true

get-view Objektbrowser | close

log [concat "write license file:" [license-file]]
read-lines -uri [concat $datadir [get-java-property "file.separator"] "MY_LIC.vnl"]|
write-lines -uri [license-file]   -append false

get-button Objektbrowser | click 
get-view ISM | get-tree | select "importierte Objekte/MyLic [64522f]/Controls [64522f]/Control [64522f]"
screen-shot-window "lic-content-decrypted.png"
get-view Objektbrowser | get-control Browser | get-property text | matches ".*<div id=\"content\"><h1>Control</h1><p><p><b><font color=\"red\">Für diesen Benutzer ist keine Lizenz zugewiesen\.<br/>Bitte kontaktieren Sie Ihren Administrator, wenn Sie diesen Inhalt nutzen möchten\.</font></b></p></p></div>.*"
    | verify-false

get-view Objektbrowser | close
log [concat "delete license file:" [license-file]]
delete-file [license-file]

get-button Objektbrowser | click 
get-view ISM | get-tree | select "importierte Objekte/MyLic [64522f]/Controls [64522f]/Control [64522f]"
screen-shot-window "lic-content-encrypted-again.png"
get-view Objektbrowser | get-control Browser | get-property text | matches ".*<div id=\"content\"><h1>Control</h1><p><p><b><font color=\"red\">Für diesen Benutzer ist keine Lizenz zugewiesen\.<br/>Bitte kontaktieren Sie Ihren Administrator, wenn Sie diesen Inhalt nutzen möchten\.</font></b></p></p></div>.*"
    | verify-true


delete-iso-model "importierte Objekte/MyLic [64522f]"
log "test-license-management"

------=_.content-0a7243a0-75d3-3d5f-9791-539de0e5b7ac--
